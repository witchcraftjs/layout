import{H as L,I as Q,r as m,J as T,Y as U,o as X,v as $,x as C,Q as D,L as G,N as P,B as K,P as Z,aa as _,O as k,$ as ee,a7 as te,_ as V,T as oe,U as re}from"./DVXjeaI0.js";import{g as ie}from"./BpX0FRyY.js";import{t as ae}from"./DeCVlzJk.js";const de=Object.assign({name:"LibPopup",inheritAttrs:!1},{__name:"WPopup",props:L({id:{type:String,required:!1},useDialogForBackdrop:{type:Boolean,required:!1,default:!1},useBackdrop:{type:Boolean,required:!1,default:!0},preferredHorizontal:{type:[Array,Function],required:!1,default:()=>["center-most","either"]},preferredVertical:{type:[Array,Function],required:!1,default:()=>["top","bottom","either"]},avoidRepositioning:{type:Boolean,required:!1,default:!1},modifyPosition:{type:Function,required:!1},canClose:{type:Boolean,required:!1,default:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:L(["close"],["update:modelValue"]),setup(l,{expose:q,emit:M}){const W=ie(),a=l,F=Q(),A=M,g=m(null),y=m(null),h=m(null),B=m(null),n=m({}),d=T(l,"modelValue",{type:Boolean,default:!1});let u=d.value;const S=()=>({x:0,y:0,width:window.innerWidth,height:window.innerHeight,top:0,bottom:0,left:0,right:0});let f;const x=(s=!1)=>{requestAnimationFrame(()=>{const H=V(a.preferredHorizontal)&&a.preferredHorizontal[0]==="center-screen",p=V(a.preferredVertical)&&a.preferredVertical[0]==="center-screen",j=(H||typeof a.preferredHorizontal=="function")&&(p||typeof a.preferredVertical=="function");if(!y.value||!g.value||!h.value&&!j){n.value={};return}const e=h.value?.getBoundingClientRect(),i=B.value?.getBoundingClientRect()??(a.useBackdrop?S():document.body.getBoundingClientRect()),r=y.value.getBoundingClientRect();let o={};if(!s&&d.value&&a.avoidRepositioning&&h.value&&f){const c=h.value.getBoundingClientRect().x-f.x,J=h.value.getBoundingClientRect().y-f.y;n.value.x+=c,n.value.y+=J,f=e;return}const t={left:0,right:0,leftLeft:0,rightRight:0,leftFromCenter:0,rightFromCenter:0,topFromCenter:0,bottomFromCenter:0,top:0,bottom:0};e&&(t.left=e.x+e.width-i.x,t.leftLeft=e.x-i.x,t.right=i.x+i.width-(e.x+e.width),t.rightRight=i.x+i.width-e.x,t.leftFromCenter=e.x+e.width/2-i.x,t.rightFromCenter=i.x+i.width-(e.x+e.width/2),t.topFromCenter=e.y+e.height/2-i.y,t.bottomFromCenter=i.y+i.height-(e.y+e.height/2),t.top=e.y-i.y,t.bottom=i.y+i.height-(e.y+e.height));const{preferredHorizontal:v,preferredVertical:w}=a;let R,z;if(typeof v=="function")o.x=v(e,r,i,t);else e:for(const c of v)switch(c){case"center-screen":r.width<i.width?o.x=i.width/2-r.width/2:(o.x=0,R=o.x);break;case"center-most":case"center":if(t.leftFromCenter>=r.width/2&&t.rightFromCenter>=r.width/2){o.x=e.x+e.width/2-r.width/2;break e}if(t.rightFromCenter+t.leftFromCenter<=r.width){o.x=0;break e}if(c==="center-most")if(t.leftFromCenter<t.rightFromCenter){o.x=e.x+e.width/2-t.leftFromCenter;break e}else{o.x=e.x+e.width/2+t.rightFromCenter-r.width;break e}break;case"left-most":if(t.left>=r.width){o.x=e.x-r.width;break e}else{o.x=0;break e}case"right-most":if(t.right>=r.width){o.x=e.x+e.width;break e}else{o.x=i.x+i.width-r.width;break e}case"right":if(t.right>=r.width){o.x=e.x;break e}break;case"left":if(t.left>=r.width){o.x=e.x+e.width-r.width;break e}break;case"either":if(t.right>=t.left){o.x=e.x;break e}else{o.x=e.x+e.width-r.width;break e}}if(typeof w=="function")o.y=w(e,r,i,t);else e:for(const c of w)switch(c){case"center-screen":r.height<i.height?o.y=i.height/2-r.height/2:(o.y=0,z=o.y);break;case"top":if(t.top>=r.height){o.y=e.y-r.height;break e}break;case"bottom":if(t.bottom>=r.height){o.y=e.y+e.height;break e}break;case"top-most":if(t.top>=r.height){o.y=e.y-r.height;break e}else{o.y=0;break e}case"bottom-most":if(t.bottom>=r.height){o.y=e.y+e.height;break e}else{o.y=i.y+i.height-r.height;break e}case"center-most":case"center":if(t.topFromCenter>=r.height/2&&t.bottomFromCenter>=r.height/2){o.y=e.y+e.height/2-r.height/2;break e}if(t.bottomFromCenter+t.topFromCenter<=r.height){o.y=0;break e}if(c==="center-most")if(t.topFromCenter<t.bottomFromCenter){o.y=e.y+e.height/2-t.topFromCenter;break e}else{o.y=e.y+e.height/2+t.bottomFromCenter-r.height;break e}break;case"either":if(t.top>=t.bottom){o.y=e.y-r.height;break e}else{o.y=e.y+e.height;break e}}o.maxWidth=R??void 0,o.maxHeight=z??void 0,a.modifyPosition&&(o=a.modifyPosition(o,e,r,i,t)),n.value=o,f=e})},I=()=>{u||(u=!0,d.value=u,a.useBackdrop&&a.useDialogForBackdrop&&g.value?.showModal(),x(!0))},E=()=>{if(u){const s=a.canClose??!1;if(A("close"),s===!1)return;u=!1,d.value=u,n.value.maxWidth=void 0,a.useBackdrop&&a.useDialogForBackdrop&&g.value?.close()}},b=()=>x(),O=()=>{window.addEventListener("resize",b),window.addEventListener("scroll",b,!0)},N=()=>{window.removeEventListener("resize",b),window.removeEventListener("scroll",b,!0)};U([d,y],()=>{d.value?(I(),O()):(E(),N())});const Y=s=>{s.preventDefault(),E()};return X(()=>{x()}),q({recompute:x,setReference:s=>{h.value=s},setBackground:s=>{B.value=s}}),(s,H)=>(C(),$(te,null,[D(s.$slots,"button",{extractEl:p=>h.value=p}),d.value||l.useDialogForBackdrop?(C(),G(ee(l.useDialogForBackdrop?"dialog":"div"),Z({key:0,id:l.id??k(W),class:k(ae)(l.useBackdrop&&l.useDialogForBackdrop&&`
			popup--backdrop
			bg-transparent
			p-0
			backdrop:bg-transparent
		`,d.value&&l.useBackdrop&&!l.useDialogForBackdrop&&`
			popup--backdrop
			z-100
			fixed
			inset-0
		`,k(F).class)},{...k(F),class:void 0},{ref_key:"dialogEl",ref:g,onMousedown:_(Y,["self"])}),{default:K(()=>[d.value?(C(),$("div",{key:0,class:re(`popup z-100 fixed ${a.avoidRepositioning?"transition-[top,left]":""}`),style:oe(`
		top:${n.value.y}px;
		left:${n.value.x}px;
		${n.value.maxWidth?`max-width:${n.value.maxWidth}px`:""}
		${n.value.maxHeight?`max-height:${n.value.maxHeight}px`:""}
		`)},[D(s.$slots,"popup",{position:n.value,extractEl:p=>y.value=p})],6)):P("",!0)]),_:3},16,["id","class"])):P("",!0)],64))}});export{de as default};
