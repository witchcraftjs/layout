import{j as p,r as _,a0 as m,aO as j,aP as $,ai as ee,H as T,aL as te,K as x,Z as se,v as D,P as E,x as M,ag as ne,ah as ae,R as H,Q as h,S as C,N as ie,aj as K,T as le,y as U,M as re,z as oe}from"#entry";import{r as ue}from"./DOfhXivz.js";import{h as ge}from"./CQ5ND8ze.js";import ce from"./BVstRHQt.js";function R(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function fe(t,a,S,g,n,o=!1){if(typeof n.suggestions?.[0]=="object"&&!n.suggestionLabel&&!n.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const l=_(-1);if(m(l,e=>{g("update:activeSuggestion",e)}),n.suggestions)for(const e of n.suggestions)N(e,n.suggestionLabel);const r=e=>(N(e,n.suggestionLabel),R(e)?n.suggestionLabel(e):e),F=(e,d)=>e===""?[...d]:d.filter(y=>Array.isArray(a.value)&&a.value.includes(r(y))?!0:r(y).toLowerCase().includes(e.toLowerCase())),b=p(()=>n.suggestionsFilter??F),f=p(()=>{if(n.suggestions){const e=[...n.suggestions];return Array.isArray(a.value)&&!n.showSelectedValues&&j(e,a.value),b.value(t.value,e)}}),i=p(()=>(f.value?.length??0)>0),P=p(()=>(f.value?.length??0)>1),A=p(()=>n.suggestions?.find(e=>t.value===r(e))),q=p(()=>!n.restrictToSuggestions&&n.isValid||i.value),s=p(()=>n.canOpen&&($(t.value)&&n.allowOpenEmpty||i.value)),u=p(()=>{if(n.suggestions){const e=i.value?f.value:n.suggestions;return n.restrictToSuggestions&&!q.value,e}});function v(e){if(Array.isArray(a.value)){if(a.value.includes(e))return ue(a.value,e),!0;j(a.value,[e])}else a.value=e;return!1}function c(){n.canClose&&(o&&console.log("closeSuggestions"),S.value=!1,l.value=-1)}function w(){o&&console.log("openSuggestions",{openable:s.value}),s.value&&(l.value===-1&&(A.value?l.value=f.value?.indexOf(A.value)??-1:l.value=0),S.value=!0)}function I(e,d=!0){if(e<-1||e>(u.value?.length??0)||(o&&console.log("enterSuggestion",e),u.value===void 0))return;const y=u.value[e],L=r(y),k=v(L);t.value=Array.isArray(a.value)?"":r(y),d&&c(),g("submit",L,ee(y),k)}function z(e=!0){if(l.value===-1){n.restrictToSuggestions?o&&console.log("enterSelected, no active suggestion, ignoring"):(o&&console.log("enterSelected, unrestricted, emitting submit"),g("submit",t.value));return}o&&console.log("enterSelected"),I(l.value,e)}function B(e){o&&console.log("selectSuggestion",e),e>=-1&&(l.value=e),e===1/0&&(u.value?.length??0)>0&&(l.value=u.value.length-1)}function G(){S.value?c():w()}function Q(){u.value&&(l.value>0?l.value--:u.value&&(l.value=u.value.length-1))}function W(){u.value&&(l.value>=u.value.length-1?l.value=0:l.value++)}function Z(){B(0)}function J(){B(1/0)}function X(){if(Array.isArray(a.value)){t.value="";return}o&&console.log("cancel"),t.value=r(a.value),c()}m(()=>n.canOpen,e=>{e||(o&&console.log("canOpen changed to false, closing suggestions"),c())}),m(s,e=>{e||(o&&console.log("openable changed to false, closing suggestions"),c())}),m(q,()=>{q.value||(o&&console.log("isValidSuggestion changed to false, opening suggestions"),w())}),m(a,()=>{Array.isArray(a.value)?t.value="":t.value=r(a.value),o&&console.log("modelValue changed")});function Y(e,d){if(d.length===0)return 0;let y,L=-1;for(let k=0;k<e.length;k++){const V=e[k],O=r(V);O.slice(0,d.length)===d&&O.length>(y?.[0]?.length??0)&&(y=O,L=k)}return L}return m(t,()=>{if(o&&console.log("input changed:",t.value,"modelValue:",a.value),!(!Array.isArray(a.value)&&r(a.value)===t.value))if(i.value&&(o&&console.log("input changed, suggestion available, opening suggestions"),w()),!n.restrictToSuggestions&&!Array.isArray(a.value)&&(o&&console.log("input changed, unrestricted, setting modelValue"),v(t.value)),A.value&&f.value)o&&console.log("input changed, exactly matching, setting activeSuggestion"),B(f.value.indexOf(A.value));else{o&&console.log("input changed, not exactly matching, finding longest match");const e=n.suggestionSelector?.(u.value??[],t.value)??Y(u.value??[],t.value);B(e)}}),{list:f,filtered:u,active:l,available:i,moreThanOneAvailable:P,hasExactlyMatching:A,hasValidSuggestion:q,openable:s,getLabel:r,$open:S,open:w,close:c,enterSelected:z,enterIndex:I,toggle:G,cancel:X,select:B,prev:Q,next:W,first:Z,last:J}}function ke(t,a,S,g){return p(()=>({"aria-autocomplete":g!==void 0?"both":void 0,"aria-controls":g!==void 0?`suggestions-${t.value}`:void 0,role:g?"combobox":void 0,"aria-expanded":g!==void 0?a.value:void 0,"aria-activedescendant":a.value?`suggestion-${t.value}-${S.value}`:void 0}))}function N(t,a){if(R(t)&&!a)throw new Error("`suggestionLabel` must be passed if suggestions are objects.")}const ve=["id","data-open"],de=["id","aria-selected","aria-label","onMouseover","onMouseup"],ye={class:"flex gap-2 nowrap"},pe=Object.assign({name:"LibSuggestions",inheritAttrs:!1},{__name:"WSuggestions",props:T({id:{type:String,required:!1},label:{type:String,required:!1},disabled:{type:Boolean,required:!1,default:!1},readonly:{type:Boolean,required:!1,default:!1},border:{type:Boolean,required:!1,default:!0},unstyle:{type:Boolean,required:!1,default:!1},filterKeydown:{type:Function,required:!1,default:void 0},filterBlur:{type:Function,required:!1},filterFocus:{type:Function,required:!1},suggestions:{type:Array,required:!1},suggestionLabel:{type:Function,required:!1},restrictToSuggestions:{type:Boolean,required:!1},updateOnlyOnSubmit:{type:Boolean,required:!1},suggestionsFilter:{type:Function,required:!1},allowOpenEmpty:{type:Boolean,required:!1},canOpen:{type:Boolean,required:!1,default:!0},canClose:{type:Boolean,required:!1,default:!0},isValid:{type:Boolean,required:!1,default:!0},suggestionSelector:{type:Function,required:!1},showSelectedValues:{type:Boolean,required:!1}},{modelValue:{type:null,required:!0},modelModifiers:{},inputValue:{type:String,default:""},inputValueModifiers:{},open:{type:Boolean,default:!1},openModifiers:{}}),emits:T(["submit","update:isOpen","update:activeSuggestion"],["update:modelValue","update:inputValue","update:open"]),setup(t,{expose:a,emit:S}){const g=te(["item"]),n=S,o=ie(),l=t,r=x(t,"modelValue",{type:null,required:!0}),F=x(t,"inputValue",{type:String,default:""}),b=x(t,"open",{type:Boolean,default:!1});if(typeof l.suggestions?.[0]=="object"&&!l.suggestionLabel&&!l.suggestionsFilter)throw new Error("`suggestionLabel` or `suggestionsFilter` must be passed if suggestions are objects.");const f=_(null),i=se(fe(F,r,b,n,l));return a({suggestions:i,el:f,inputKeydownHandler:s=>{l.filterKeydown?.(s)||ge(s)||(s.key==="Enter"?(i.enterSelected(!Array.isArray(r)),s.preventDefault()):s.key==="Escape"?(i.cancel(),s.preventDefault()):!b.value&&["ArrowDown","ArrowUp","PageUp","PageDown"].includes(s.key)&&i.available?(i.open(),s.preventDefault(),s.key==="PageUp"?i.first():s.key==="PageDown"&&i.last()):s.key==="ArrowUp"?(i.prev(),s.preventDefault()):s.key==="ArrowDown"?(i.next(),s.preventDefault()):s.key==="PageUp"?(i.first(),s.preventDefault()):s.key==="PageDown"&&(i.last(),s.preventDefault()))},inputBlurHandler:s=>{l.filterBlur?.(s)||b.value&&(l.restrictToSuggestions?i.cancel():Array.isArray(r.value)||(r.value=F.value),b.value&&i.close())},inputFocusHandler:s=>{l.filterFocus?.(s)||i.open()}}),(s,u)=>b.value?(M(),D("div",H({key:0,id:`suggestions-${t.id??h(o)}`,class:h(C)(`
			suggestions
			bg-bg
			dark:bg-fg
			dark:text-bg
		`,h(g).attrs?.class),"data-open":b.value,role:"listbox",ref_key:"el",ref:f},{...h(g).attrs,class:void 0}),[(M(!0),D(ne,null,ae(i.filtered,(v,c)=>(M(),D("div",H({id:`suggestion-${t.id??h(o)}-${c}`,role:"option",class:h(C)(`
			suggestions--item
			user-select-none
			cursor-pointer
			px-2
		`,c===i.active&&`
				bg-accent-200
				dark:bg-accent-800/70
			`,h(g).itemAttrs?.class)},{ref_for:!0},{...h(g).itemAttrs,class:void 0},{"aria-selected":c===i.active,"aria-label":i.getLabel(v),key:v,onMouseover:w=>i.active=c,onMousedown:u[1]||(u[1]=K(()=>{},["prevent"])),onMouseup:w=>i.enterIndex(c,!Array.isArray(r.value))}),[le(s.$slots,"item",{item:v,index:c,isSelected:Array.isArray(r.value)?r.value.includes(v):r.value===v},()=>[U("div",ye,[Array.isArray(r.value)&&t.showSelectedValues?(M(),re(ce,{key:0,"model-value":r.value.includes(v),onMousedown:u[0]||(u[0]=K(()=>{},["prevent"]))},null,8,["model-value"])):E("",!0),U("div",null,oe(v),1)])])],16,de))),128))],16,ve)):E("",!0)}}),me=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{me as L,pe as _,ke as u};
