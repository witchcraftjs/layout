import{H as D,J as K,r as p,K as Q,a0 as T,o as Y,v as L,x as C,T as M,M as G,P,B as U,R as Z,aj as _,Q as k,S as ee,N as te,a5 as oe,ag as re,a2 as V,W as ie,X as ae}from"#entry";const se=Object.assign({name:"LibPopup",inheritAttrs:!1},{__name:"WPopup",props:D({id:{type:String,required:!1},useDialogForBackdrop:{type:Boolean,required:!1,default:!1},useBackdrop:{type:Boolean,required:!1,default:!0},preferredHorizontal:{type:[Array,Function],required:!1,default:()=>["center-most","either"]},preferredVertical:{type:[Array,Function],required:!1,default:()=>["top","bottom","either"]},avoidRepositioning:{type:Boolean,required:!1,default:!1},modifyPosition:{type:Function,required:!1},canClose:{type:Boolean,required:!1,default:!0}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:D(["close"],["update:modelValue"]),setup(l,{expose:$,emit:q}){const W=te(),a=l,F=K(),A=q,m=p(null),y=p(null),h=p(null),B=p(null),n=p({}),d=Q(l,"modelValue",{type:Boolean,default:!1});let u=d.value;const S=()=>({x:0,y:0,width:window.innerWidth,height:window.innerHeight,top:0,bottom:0,left:0,right:0});let f;const x=(s=!1)=>{requestAnimationFrame(()=>{const E=V(a.preferredHorizontal)&&a.preferredHorizontal[0]==="center-screen",g=V(a.preferredVertical)&&a.preferredVertical[0]==="center-screen",X=(E||typeof a.preferredHorizontal=="function")&&(g||typeof a.preferredVertical=="function");if(!y.value||!m.value||!h.value&&!X){n.value={};return}const e=h.value?.getBoundingClientRect(),i=B.value?.getBoundingClientRect()??(a.useBackdrop?S():document.body.getBoundingClientRect()),r=y.value.getBoundingClientRect();let o={};if(!s&&d.value&&a.avoidRepositioning&&h.value&&f){const c=h.value.getBoundingClientRect().x-f.x,J=h.value.getBoundingClientRect().y-f.y;n.value.x+=c,n.value.y+=J,f=e;return}const t={left:0,right:0,leftLeft:0,rightRight:0,leftFromCenter:0,rightFromCenter:0,topFromCenter:0,bottomFromCenter:0,top:0,bottom:0};e&&(t.left=e.x+e.width-i.x,t.leftLeft=e.x-i.x,t.right=i.x+i.width-(e.x+e.width),t.rightRight=i.x+i.width-e.x,t.leftFromCenter=e.x+e.width/2-i.x,t.rightFromCenter=i.x+i.width-(e.x+e.width/2),t.topFromCenter=e.y+e.height/2-i.y,t.bottomFromCenter=i.y+i.height-(e.y+e.height/2),t.top=e.y-i.y,t.bottom=i.y+i.height-(e.y+e.height));const{preferredHorizontal:v,preferredVertical:w}=a;let H,z;if(typeof v=="function")o.x=v(e,r,i,t);else e:for(const c of v)switch(c){case"center-screen":r.width<i.width?o.x=i.width/2-r.width/2:(o.x=0,H=o.x);break;case"center-most":case"center":if(t.leftFromCenter>=r.width/2&&t.rightFromCenter>=r.width/2){o.x=e.x+e.width/2-r.width/2;break e}if(t.rightFromCenter+t.leftFromCenter<=r.width){o.x=0;break e}if(c==="center-most")if(t.leftFromCenter<t.rightFromCenter){o.x=e.x+e.width/2-t.leftFromCenter;break e}else{o.x=e.x+e.width/2+t.rightFromCenter-r.width;break e}break;case"left-most":if(t.left>=r.width){o.x=e.x-r.width;break e}else{o.x=0;break e}case"right-most":if(t.right>=r.width){o.x=e.x+e.width;break e}else{o.x=i.x+i.width-r.width;break e}case"right":if(t.right>=r.width){o.x=e.x;break e}break;case"left":if(t.left>=r.width){o.x=e.x+e.width-r.width;break e}break;case"either":if(t.right>=t.left){o.x=e.x;break e}else{o.x=e.x+e.width-r.width;break e}}if(typeof w=="function")o.y=w(e,r,i,t);else e:for(const c of w)switch(c){case"center-screen":r.height<i.height?o.y=i.height/2-r.height/2:(o.y=0,z=o.y);break;case"top":if(t.top>=r.height){o.y=e.y-r.height;break e}break;case"bottom":if(t.bottom>=r.height){o.y=e.y+e.height;break e}break;case"top-most":if(t.top>=r.height){o.y=e.y-r.height;break e}else{o.y=0;break e}case"bottom-most":if(t.bottom>=r.height){o.y=e.y+e.height;break e}else{o.y=i.y+i.height-r.height;break e}case"center-most":case"center":if(t.topFromCenter>=r.height/2&&t.bottomFromCenter>=r.height/2){o.y=e.y+e.height/2-r.height/2;break e}if(t.bottomFromCenter+t.topFromCenter<=r.height){o.y=0;break e}if(c==="center-most")if(t.topFromCenter<t.bottomFromCenter){o.y=e.y+e.height/2-t.topFromCenter;break e}else{o.y=e.y+e.height/2+t.bottomFromCenter-r.height;break e}break;case"either":if(t.top>=t.bottom){o.y=e.y-r.height;break e}else{o.y=e.y+e.height;break e}}o.maxWidth=H??void 0,o.maxHeight=z??void 0,a.modifyPosition&&(o=a.modifyPosition(o,e,r,i,t)),n.value=o,f=e})},j=()=>{u||(u=!0,d.value=u,a.useBackdrop&&a.useDialogForBackdrop&&m.value?.showModal(),x(!0))},R=()=>{if(u){const s=a.canClose??!1;if(A("close"),s===!1)return;u=!1,d.value=u,n.value.maxWidth=void 0,a.useBackdrop&&a.useDialogForBackdrop&&m.value?.close()}},b=()=>x(),I=()=>{window.addEventListener("resize",b),window.addEventListener("scroll",b,!0)},N=()=>{window.removeEventListener("resize",b),window.removeEventListener("scroll",b,!0)};T([d,y],()=>{d.value?(j(),I()):(R(),N())});const O=s=>{s.preventDefault(),R()};return Y(()=>{x()}),$({recompute:x,setReference:s=>{h.value=s},setBackground:s=>{B.value=s}}),(s,E)=>(C(),L(re,null,[M(s.$slots,"button",{extractEl:g=>h.value=g}),d.value||l.useDialogForBackdrop?(C(),G(oe(l.useDialogForBackdrop?"dialog":"div"),Z({key:0,id:l.id??k(W),class:k(ee)(l.useBackdrop&&l.useDialogForBackdrop&&`
			popup--backdrop
			bg-transparent
			p-0
			backdrop:bg-transparent
		`,d.value&&l.useBackdrop&&!l.useDialogForBackdrop&&`
			popup--backdrop
			z-100
			fixed
			inset-0
		`,k(F).class)},{...k(F),class:void 0},{ref_key:"dialogEl",ref:m,onMousedown:_(O,["self"])}),{default:U(()=>[d.value?(C(),L("div",{key:0,class:ae(`popup z-100 fixed ${a.avoidRepositioning?"transition-[top,left]":""}`),style:ie(`
		top:${n.value.y}px;
		left:${n.value.x}px;
		${n.value.maxWidth?`max-width:${n.value.maxWidth}px`:""}
		${n.value.maxHeight?`max-height:${n.value.maxHeight}px`:""}
		`)},[M(s.$slots,"popup",{position:n.value,extractEl:g=>y.value=g})],6)):P("",!0)]),_:3},16,["id","class"])):P("",!0)],64))}});export{se as default};
